<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - PANGS!T Store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #ff6b35;
            --primary-dark: #e55a2b;
            --secondary: #2d3047;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', sans-serif;
        }
        
        body {
            background: #f5f5f5;
            color: var(--dark);
        }
        
        .admin-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: var(--secondary);
            color: white;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .logo-admin {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        
        .logo-admin h2 {
            color: var(--primary);
            font-size: 24px;
        }
        
        .nav-admin {
            list-style: none;
        }
        
        .nav-admin li {
            margin-bottom: 5px;
        }
        
        .nav-admin a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 25px;
            color: white;
            text-decoration: none;
            transition: 0.3s;
        }
        
        .nav-admin a:hover,
        .nav-admin a.active {
            background: rgba(255,255,255,0.1);
            border-left: 4px solid var(--primary);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
        }
        
        .header-admin {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }
        
        .icon-orders { background: var(--primary); }
        .icon-revenue { background: var(--success); }
        .icon-pending { background: var(--warning); }
        .icon-customers { background: var(--info); }
        
        .stat-info h3 {
            font-size: 32px;
            margin-bottom: 5px;
        }
        
        /* Orders Table */
        .orders-container {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .orders-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: var(--light);
            padding: 15px;
            text-align: left;
            color: var(--secondary);
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-new { background: #cce5ff; color: #004085; }
        .badge-processing { background: #d1ecf1; color: #0c5460; }
        .badge-shipped { background: #d4edda; color: #155724; }
        .badge-delivered { background: #d1e7dd; color: #0f5132; }
        .badge-cancelled { background: #f8d7da; color: #721c24; }
        
        /* Payment Status */
        .payment-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .payment-pending { background: #fff3cd; color: #856404; }
        .payment-paid { background: #d4edda; color: #155724; }
        .payment-failed { background: #f8d7da; color: #721c24; }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .btn-action {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-view { background: #17a2b8; color: white; }
        .btn-process { background: #28a745; color: white; }
        .btn-ship { background: #007bff; color: white; }
        .btn-cancel { background: #dc3545; color: white; }
        .btn-edit { background: #ffc107; color: #212529; }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }
        
        /* Form Groups */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--secondary);
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            font-size: 14px;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
                overflow: hidden;
            }
            
            .sidebar:hover {
                width: 250px;
            }
            
            .nav-admin a span {
                display: none;
            }
            
            .sidebar:hover .nav-admin a span {
                display: inline;
            }
            
            .main-content {
                margin-left: 70px;
            }
            
            .sidebar:hover + .main-content {
                margin-left: 250px;
            }
        }
        
        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .header-admin {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo-admin">
                <h2><i class="fas fa-dumpling"></i> PANGS!T Admin</h2>
                <p style="font-size: 12px; opacity: 0.8;">Control Panel</p>
            </div>
            
            <ul class="nav-admin">
                <li><a href="#" class="active" data-tab="dashboard"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
                <li><a href="#" data-tab="orders"><i class="fas fa-shopping-cart"></i> <span>Pesanan</span></a></li>
                <li><a href="#" data-tab="products"><i class="fas fa-box"></i> <span>Produk</span></a></li>
                <li><a href="#" data-tab="payments"><i class="fas fa-credit-card"></i> <span>Pembayaran</span></a></li>
                <li><a href="#" data-tab="customers"><i class="fas fa-users"></i> <span>Pelanggan</span></a></li>
                <li><a href="#" data-tab="settings"><i class="fas fa-cog"></i> <span>Pengaturan</span></a></li>
            </ul>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header-admin">
                <h1>Dashboard Admin</h1>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span id="currentTime"></span>
                    <button class="btn-action" style="background: var(--primary); color: white;">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <!-- Stats Cards -->
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-icon icon-orders">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalOrders">0</h3>
                        <p>Total Pesanan</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon icon-revenue">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalRevenue">Rp 0</h3>
                        <p>Total Pendapatan</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon icon-pending">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="pendingOrders">0</h3>
                        <p>Pesanan Pending</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon icon-customers">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalCustomers">0</h3>
                        <p>Total Pelanggan</p>
                    </div>
                </div>
            </div>
            
            <!-- Orders Section -->
            <div class="orders-container" id="ordersTab">
                <div class="orders-header">
                    <h2>Daftar Pesanan</h2>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" placeholder="Cari pesanan..." class="form-control" style="width: 200px;" id="searchOrder">
                        <select class="form-control" style="width: 150px;" id="filterStatus">
                            <option value="">Semua Status</option>
                            <option value="pending">Pending</option>
                            <option value="processing">Diproses</option>
                            <option value="shipped">Dikirim</option>
                            <option value="delivered">Selesai</option>
                            <option value="cancelled">Dibatalkan</option>
                        </select>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table id="ordersTable">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Tanggal</th>
                                <th>Pelanggan</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Pembayaran</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                            <!-- Data pesanan akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Other tabs (Products, Payments, etc.) -->
            <div id="productsTab" style="display: none;">
                <!-- Tab Produk -->
            </div>
            
            <div id="paymentsTab" style="display: none;">
                <!-- Tab Pembayaran -->
            </div>
        </div>
    </div>
    
    <!-- Modal Detail Pesanan -->
    <div class="modal" id="orderDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Detail Pesanan</h3>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="orderDetailContent">
                <!-- Detail pesanan akan diisi oleh JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Modal Konfirmasi Pembayaran -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Konfirmasi Pembayaran</h3>
                <button class="close-modal" onclick="closePaymentModal()">&times;</button>
            </div>
            <div class="modal-body" id="paymentContent">
                <!-- Form konfirmasi pembayaran -->
            </div>
        </div>
    </div>

    <script>
        // Key untuk localStorage (SAMA dengan halaman toko)
        const STORAGE_KEY = 'pangsit_orders_master';
        
        // Status yang tersedia
        const ORDER_STATUS = {
            PENDING: 'pending',
            PROCESSING: 'processing',
            SHIPPED: 'shipped',
            DELIVERED: 'delivered',
            CANCELLED: 'cancelled'
        };
        
        const PAYMENT_STATUS = {
            PENDING: 'menunggu',
            PROCESSING: 'diproses',
            PAID: 'lunas',
            CANCELLED: 'dibatalkan'
        };
        
        // Data pesanan
        let orders = [];
        
        // Format Rupiah
        function formatRupiah(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount || 0);
        }
        
        // Format tanggal
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // Ambil data dari localStorage
        function loadOrders() {
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                orders = data ? JSON.parse(data) : [];
                updateStats();
                renderOrdersTable();
            } catch (error) {
                console.error('Error loading orders:', error);
                orders = [];
            }
        }
        
        // Simpan data ke localStorage
        function saveOrders() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(orders));
                updateStats();
                renderOrdersTable();
                return true;
            } catch (error) {
                console.error('Error saving orders:', error);
                return false;
            }
        }
        
        // Update statistik
        function updateStats() {
            // Total pesanan
            document.getElementById('totalOrders').textContent = orders.length;
            
            // Total pendapatan (hitung dari pesanan yang sudah dibayar)
            const totalRevenue = orders
                .filter(order => order.paymentStatus === PAYMENT_STATUS.PAID)
                .reduce((sum, order) => sum + (order.total || 0), 0);
            document.getElementById('totalRevenue').textContent = formatRupiah(totalRevenue);
            
            // Pesanan pending
            const pendingOrders = orders.filter(order => 
                order.status === ORDER_STATUS.PENDING || 
                order.paymentStatus === PAYMENT_STATUS.PENDING
            ).length;
            document.getElementById('pendingOrders').textContent = pendingOrders;
            
            // Total pelanggan (unique)
            const uniqueCustomers = [...new Set(orders.map(order => 
                order.customer?.phone || order.customer?.email || ''
            ))].filter(Boolean).length;
            document.getElementById('totalCustomers').textContent = uniqueCustomers;
        }
        
        // Render tabel pesanan
        function renderOrdersTable() {
            const tableBody = document.getElementById('ordersTableBody');
            if (!tableBody) return;
            
            // Filter berdasarkan search
            const searchTerm = document.getElementById('searchOrder')?.value.toLowerCase() || '';
            const statusFilter = document.getElementById('filterStatus')?.value || '';
            
            let filteredOrders = orders.filter(order => {
                // Filter search
                const matchesSearch = !searchTerm || 
                    order.id?.toLowerCase().includes(searchTerm) ||
                    order.customer?.name?.toLowerCase().includes(searchTerm) ||
                    order.customer?.phone?.includes(searchTerm);
                
                // Filter status
                const matchesStatus = !statusFilter || 
                    order.status === statusFilter ||
                    (statusFilter === 'pending' && order.paymentStatus === PAYMENT_STATUS.PENDING);
                
                return matchesSearch && matchesStatus;
            });
            
            // Urutkan berdasarkan tanggal terbaru
            filteredOrders.sort((a, b) => {
                const dateA = new Date(a.createdAt || a.timestamp || 0);
                const dateB = new Date(b.createdAt || b.timestamp || 0);
                return dateB - dateA;
            });
            
            tableBody.innerHTML = '';
            
            if (filteredOrders.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px;">
                            <i class="fas fa-inbox" style="font-size: 48px; color: #ccc; margin-bottom: 15px;"></i>
                            <p>Tidak ada pesanan</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredOrders.forEach(order => {
                const row = document.createElement('tr');
                
                // Tentukan badge status pesanan
                let statusBadge = '';
                let statusText = '';
                
                switch(order.status) {
                    case ORDER_STATUS.PENDING:
                        statusBadge = 'badge-new';
                        statusText = 'Baru';
                        break;
                    case ORDER_STATUS.PROCESSING:
                        statusBadge = 'badge-processing';
                        statusText = 'Diproses';
                        break;
                    case ORDER_STATUS.SHIPPED:
                        statusBadge = 'badge-shipped';
                        statusText = 'Dikirim';
                        break;
                    case ORDER_STATUS.DELIVERED:
                        statusBadge = 'badge-delivered';
                        statusText = 'Selesai';
                        break;
                    case ORDER_STATUS.CANCELLED:
                        statusBadge = 'badge-cancelled';
                        statusText = 'Batal';
                        break;
                    default:
                        statusBadge = 'badge-new';
                        statusText = 'Baru';
                }
                
                // Tentukan badge status pembayaran
                let paymentBadge = '';
                let paymentText = '';
                
                switch(order.paymentStatus) {
                    case PAYMENT_STATUS.PAID:
                        paymentBadge = 'payment-paid';
                        paymentText = 'LUNAS';
                        break;
                    case PAYMENT_STATUS.PROCESSING:
                        paymentBadge = 'payment-pending';
                        paymentText = 'DIPROSES';
                        break;
                    case PAYMENT_STATUS.CANCELLED:
                        paymentBadge = 'payment-failed';
                        paymentText = 'BATAL';
                        break;
                    default:
                        paymentBadge = 'payment-pending';
                        paymentText = 'MENUNGGU';
                }
                
                row.innerHTML = `
                    <td>
                        <strong>${order.id || 'N/A'}</strong><br>
                        <small style="color: #666;">${order.paymentMethod ? order.paymentMethod.toUpperCase() : 'N/A'}</small>
                    </td>
                    <td>${order.date || 'N/A'}<br>${order.time || ''}</td>
                    <td>
                        <strong>${order.customer?.name || 'N/A'}</strong><br>
                        <small>${order.customer?.phone || 'N/A'}</small>
                    </td>
                    <td><strong>${formatRupiah(order.total || 0)}</strong></td>
                    <td><span class="status-badge ${statusBadge}">${statusText}</span></td>
                    <td><span class="payment-badge ${paymentBadge}">${paymentText}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-view" onclick="viewOrderDetail('${order.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-action btn-process" onclick="updateOrderStatus('${order.id}', 'processing')" 
                                    ${order.status !== 'pending' ? 'disabled style="opacity:0.5"' : ''}>
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="btn-action btn-ship" onclick="updateOrderStatus('${order.id}', 'shipped')"
                                    ${order.status !== 'processing' ? 'disabled style="opacity:0.5"' : ''}>
                                <i class="fas fa-truck"></i>
                            </button>
                            <button class="btn-action btn-cancel" onclick="updateOrderStatus('${order.id}', 'cancelled')"
                                    ${order.status === 'cancelled' || order.status === 'delivered' ? 'disabled style="opacity:0.5"' : ''}>
                                <i class="fas fa-times"></i>
                            </button>
                            <button class="btn-action btn-edit" onclick="showPaymentConfirmation('${order.id}')">
                                <i class="fas fa-credit-card"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // Tampilkan detail pesanan
        function viewOrderDetail(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            const modal = document.getElementById('orderDetailModal');
            const content = document.getElementById('orderDetailContent');
            
            content.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <h4>Informasi Pesanan</h4>
                        <p><strong>ID:</strong> ${order.id}</p>
                        <p><strong>Tanggal:</strong> ${order.date} ${order.time}</p>
                        <p><strong>Status:</strong> ${order.status || 'pending'}</p>
                        <p><strong>Pembayaran:</strong> ${order.paymentStatus || 'menunggu'}</p>
                        <p><strong>Metode:</strong> ${order.paymentMethod || 'N/A'}</p>
                    </div>
                    <div>
                        <h4>Informasi Pelanggan</h4>
                        <p><strong>Nama:</strong> ${order.customer?.name || 'N/A'}</p>
                        <p><strong>Telepon:</strong> ${order.customer?.phone || 'N/A'}</p>
                        <p><strong>Email:</strong> ${order.customer?.email || 'N/A'}</p>
                        <p><strong>Alamat:</strong> ${order.customer?.address || 'N/A'}</p>
                    </div>
                </div>
                
                <h4>Items Pesanan</h4>
                <table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                    <thead>
                        <tr style="background: #f8f9fa;">
                            <th style="padding: 10px; text-align: left;">Produk</th>
                            <th style="padding: 10px; text-align: center;">Qty</th>
                            <th style="padding: 10px; text-align: right;">Harga</th>
                            <th style="padding: 10px; text-align: right;">Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${order.products ? order.products.map(product => `
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">${product.name}</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: center;">${product.quantity}</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">${formatRupiah(product.price)}</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">${formatRupiah(product.price * product.quantity)}</td>
                            </tr>
                        `).join('') : ''}
                    </tbody>
                </table>
                
                <div style="float: right; width: 300px; margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Subtotal:</span>
                        <span>${formatRupiah(order.subtotal || 0)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Pengiriman:</span>
                        <span>${formatRupiah(order.shipping || 0)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Pajak:</span>
                        <span>${formatRupiah(order.tax || 0)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 18px; border-top: 2px solid #ff6b35; padding-top: 10px;">
                        <span>TOTAL:</span>
                        <span style="color: #ff6b35;">${formatRupiah(order.total || 0)}</span>
                    </div>
                </div>
                <div style="clear: both;"></div>
                
                ${order.notes ? `
                    <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                        <h4>Catatan Pelanggan</h4>
                        <p>${order.notes}</p>
                    </div>
                ` : ''}
                
                <div style="margin-top: 25px; display: flex; gap: 10px; justify-content: center;">
                    <button class="btn-action" style="background: #28a745; color: white; padding: 10px 20px;" 
                            onclick="printOrder('${order.id}')">
                        <i class="fas fa-print"></i> Cetak
                    </button>
                    <button class="btn-action" style="background: #17a2b8; color: white; padding: 10px 20px;" 
                            onclick="closeModal()">
                        <i class="fas fa-times"></i> Tutup
                    </button>
                </div>
            `;
            
            modal.classList.add('active');
        }
        
        // Update status pesanan
        function updateOrderStatus(orderId, newStatus) {
            if (!confirm(`Ubah status pesanan ${orderId} menjadi ${newStatus}?`)) return;
            
            const orderIndex = orders.findIndex(o => o.id === orderId);
            if (orderIndex === -1) return;
            
            orders[orderIndex].status = newStatus;
            orders[orderIndex].updatedAt = new Date().toISOString();
            
            // Jika status menjadi delivered, otomatis set payment jadi lunas
            if (newStatus === ORDER_STATUS.DELIVERED && orders[orderIndex].paymentStatus !== PAYMENT_STATUS.PAID) {
                orders[orderIndex].paymentStatus = PAYMENT_STATUS.PAID;
            }
            
            // Jika status dibatalkan, otomatis set payment jadi dibatalkan
            if (newStatus === ORDER_STATUS.CANCELLED && orders[orderIndex].paymentStatus !== PAYMENT_STATUS.CANCELLED) {
                orders[orderIndex].paymentStatus = PAYMENT_STATUS.CANCELLED;
            }
            
            saveOrders();
            alert(`Status pesanan ${orderId} berhasil diubah!`);
        }
        
        // Tampilkan modal konfirmasi pembayaran
        function showPaymentConfirmation(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            const modal = document.getElementById('paymentModal');
            const content = document.getElementById('paymentContent');
            
            content.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h4 style="color: #ff6b35;">Konfirmasi Pembayaran</h4>
                    <p>Order ID: <strong>${order.id}</strong></p>
                    <p>Pelanggan: <strong>${order.customer?.name || 'N/A'}</strong></p>
                    <p>Total: <strong style="font-size: 24px;">${formatRupiah(order.total)}</strong></p>
                </div>
                
                <div class="form-group">
                    <label>Status Pembayaran</label>
                    <select id="paymentStatusSelect" class="form-control">
                        <option value="${PAYMENT_STATUS.PENDING}" ${order.paymentStatus === PAYMENT_STATUS.PENDING ? 'selected' : ''}>
                            Menunggu Pembayaran
                        </option>
                        <option value="${PAYMENT_STATUS.PROCESSING}" ${order.paymentStatus === PAYMENT_STATUS.PROCESSING ? 'selected' : ''}>
                            Pembayaran Diproses
                        </option>
                        <option value="${PAYMENT_STATUS.PAID}" ${order.paymentStatus === PAYMENT_STATUS.PAID ? 'selected' : ''}>
                            LUNAS
                        </option>
                        <option value="${PAYMENT_STATUS.CANCELLED}" ${order.paymentStatus === PAYMENT_STATUS.CANCELLED ? 'selected' : ''}>
                            Dibatalkan
                        </option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Catatan Admin (Opsional)</label>
                    <textarea id="adminNote" class="form-control" rows="3" placeholder="Contoh: Transfer sudah diterima, dll.">${order.adminNote || ''}</textarea>
                </div>
                
                <div style="margin-top: 25px; display: flex; gap: 10px; justify-content: center;">
                    <button class="btn-action" style="background: #28a745; color: white; padding: 10px 20px;" 
                            onclick="confirmPayment('${order.id}')">
                        <i class="fas fa-check"></i> Simpan
                    </button>
                    <button class="btn-action" style="background: #dc3545; color: white; padding: 10px 20px;" 
                            onclick="closePaymentModal()">
                        <i class="fas fa-times"></i> Batal
                    </button>
                </div>
            `;
            
            modal.classList.add('active');
        }
        
        // Konfirmasi pembayaran
        function confirmPayment(orderId) {
            const paymentStatus = document.getElementById('paymentStatusSelect').value;
            const adminNote = document.getElementById('adminNote').value;
            
            const orderIndex = orders.findIndex(o => o.id === orderId);
            if (orderIndex === -1) return;
            
            orders[orderIndex].paymentStatus = paymentStatus;
            orders[orderIndex].adminNote = adminNote;
            orders[orderIndex].updatedAt = new Date().toISOString();
            
            // Jika pembayaran lunas, ubah status pesanan jadi processing
            if (paymentStatus === PAYMENT_STATUS.PAID && orders[orderIndex].status === ORDER_STATUS.PENDING) {
                orders[orderIndex].status = ORDER_STATUS.PROCESSING;
            }
            
            // Jika pembayaran dibatalkan, ubah status pesanan jadi cancelled
            if (paymentStatus === PAYMENT_STATUS.CANCELLED && orders[orderIndex].status !== ORDER_STATUS.CANCELLED) {
                orders[orderIndex].status = ORDER_STATUS.CANCELLED;
            }
            
            saveOrders();
            closePaymentModal();
            alert(`Status pembayaran ${orderId} berhasil diupdate!`);
        }
        
        // Cetak order
        function printOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Invoice ${order.id}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .invoice-header { text-align: center; margin-bottom: 30px; }
                        .invoice-logo { font-size: 28px; font-weight: bold; color: #ff6b35; }
                        .invoice-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        .invoice-table th, .invoice-table td { padding: 10px; border: 1px solid #ddd; }
                        .invoice-table th { background-color: #f5f5f5; }
                        @media print {
                            body { margin: 0; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="invoice-header">
                        <div class="invoice-logo">PANGS!T STORE</div>
                        <p>Jl.panongan desa panongan kec panongan kabupaten tangerang</p>
                        <p>Telepon: +62 831-9524-3139</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <h4>INVOICE</h4>
                            <p><strong>No:</strong> ${order.id}</p>
                            <p><strong>Tanggal:</strong> ${order.date} ${order.time}</p>
                            <p><strong>Status:</strong> ${order.status}</p>
                            <p><strong>Pembayaran:</strong> ${order.paymentStatus}</p>
                        </div>
                        <div>
                            <h4>PELANGGAN</h4>
                            <p><strong>Nama:</strong> ${order.customer?.name || 'N/A'}</p>
                            <p><strong>Telp:</strong> ${order.customer?.phone || 'N/A'}</p>
                            <p><strong>Alamat:</strong> ${order.customer?.address || 'N/A'}</p>
                        </div>
                    </div>
                    
                    <table class="invoice-table">
                        <thead>
                            <tr>
                                <th>Produk</th>
                                <th>Qty</th>
                                <th>Harga</th>
                                <th>Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${order.products ? order.products.map(product => `
                                <tr>
                                    <td>${product.name}</td>
                                    <td>${product.quantity}</td>
                                    <td>Rp ${product.price.toLocaleString()}</td>
                                    <td>Rp ${(product.price * product.quantity).toLocaleString()}</td>
                                </tr>
                            `).join('') : ''}
                        </tbody>
                    </table>
                    
                    <div style="float: right; width: 300px; margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Subtotal:</span>
                            <span>Rp ${(order.subtotal || 0).toLocaleString()}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Pengiriman:</span>
                            <span>Rp ${(order.shipping || 0).toLocaleString()}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Pajak:</span>
                            <span>Rp ${(order.tax || 0).toLocaleString()}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 20px; border-top: 2px solid #ff6b35; padding-top: 10px;">
                            <span>TOTAL:</span>
                            <span>Rp ${(order.total || 0).toLocaleString()}</span>
                        </div>
                    </div>
                    <div style="clear: both;"></div>
                    
                    <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd;">
                        <p><strong>Catatan:</strong> ${order.notes || 'Tidak ada catatan'}</p>
                        <p><strong>Catatan Admin:</strong> ${order.adminNote || 'Tidak ada catatan'}</p>
                    </div>
                    
                    <div class="no-print" style="text-align: center; margin-top: 30px;">
                        <button onclick="window.print()" style="padding: 10px 20px; background: #ff6b35; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Cetak Invoice
                        </button>
                        <button onclick="window.close()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                            Tutup
                        </button>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
        }
        
        // Tutup modal
        function closeModal() {
            document.getElementById('orderDetailModal').classList.remove('active');
        }
        
        function closePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
        }
        
        // Update waktu real-time
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const timeElement = document.getElementById('currentTime');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }
        
        // Setup tab navigation
        function setupTabs() {
            const tabs = document.querySelectorAll('.nav-admin a');
            tabs.forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding content
                    const tabId = this.getAttribute('data-tab');
                    document.querySelectorAll('.main-content > div').forEach(content => {
                        content.style.display = 'none';
                    });
                    
                    document.getElementById(`${tabId}Tab`).style.display = 'block';
                });
            });
        }
        
        // Auto-refresh data setiap 5 detik
        function autoRefresh() {
            setInterval(() => {
                loadOrders();
            }, 5000);
        }
        
        // Inisialisasi
        function init() {
            loadOrders();
            setupTabs();
            updateTime();
            setInterval(updateTime, 1000);
            autoRefresh();
            
            // Event listener untuk search
            const searchInput = document.getElementById('searchOrder');
            const filterSelect = document.getElementById('filterStatus');
            
            if (searchInput) {
                searchInput.addEventListener('input', renderOrdersTable);
            }
            
            if (filterSelect) {
                filterSelect.addEventListener('change', renderOrdersTable);
            }
            
            console.log('âœ… Admin Panel siap!');
        }
        
        // Jalankan saat halaman dimuat
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
